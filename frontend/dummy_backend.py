import os
import subprocess
import socket
#from urllib.parse import urlparse
#from scapy.all import *


class AliceBackend:

    """
    AliceDatabase browse theu url, captures the packets, and provides frontend with information extracted from the packets.
    """

    def __init__(self) -> None:
        self.enc_file = "encrypted.pcap"
        self.dec_file = "decrypted.pcap"
        self.key_file = "sslkeys.txt"
        self.url = "https://www.google.com"
        pass

    def browse_and_capture(self, url=None):
        """
        This function browses the provided URL, captures the transmitted packets, and decrypts the packets.
        """
        print("BROWSE AND CAPTURE")

    def get_encrypted_packets(self):
        """
        This function returns the encrypted packets information in a dictionary.
        """
        return {1: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https S', 2: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 SA / Padding', 3: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 4: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Handshake - Client Hello', 5: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 6: 'Ether / IP / TCP / TLS / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS ChangeCipherSpec / Raw', 7: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 8: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 PA / _TLSEncryptedContent', 9: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 10: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 PA / _TLSEncryptedContent', 11: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 12: 'Ether / IP / TCP / TLS / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 13: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 14: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 15: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 16: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 17: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 18: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 19: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 20: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 21: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 22: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 23: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 24: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 25: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 26: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 27: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 28: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 29: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 30: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 31: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https FA', 32: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 33: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 34: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https R', 35: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 FPA / Padding', 36: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https R'}

    def get_decrypted_packets(self):
        """
        This function returns the decrypted packets information in a dictionary.
        """
        return {1: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https S', 2: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 SA / Padding', 3: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 4: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Handshake - Client Hello', 5: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 6: 'Ether / IP / TCP / TLS / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS ChangeCipherSpec / Raw', 7: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 8: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 PA / _TLSEncryptedContent', 9: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 10: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 PA / _TLSEncryptedContent', 11: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 12: 'Ether / IP / TCP / TLS / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 13: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 14: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 15: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 16: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 17: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 18: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 19: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 20: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 21: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 22: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 23: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 24: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https A', 25: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 26: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 27: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 28: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 29: 'Ether / IP / TCP / TLS 192.168.10.128:43222 > 208.80.153.224:443 / TLS / TLS Application Data', 30: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 31: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https FA', 32: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 A / Padding', 33: 'Ether / IP / TCP / TLS 208.80.153.224:443 > 192.168.10.128:43222 / TLS / TLS Application Data', 34: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https R', 35: 'Ether / IP / TCP 208.80.153.224:https > 192.168.10.128:43222 FPA / Padding', 36: 'Ether / IP / TCP 192.168.10.128:43222 > 208.80.153.224:https R'}

    def get_tcp_handshake_details(self):
        return {'syn_seq': 573285563, 'syn_sending_port': 43222, 'syn_destination_port': 443, 'syn_ack_seq': 2255547009, 'syn_ack_sending_port': 443, 'syn_ack_destination_port': 43222, 'ack_seq': 2255553649, 'ack_sending_port': 443, 'ack_destination_port': 43222}

    def get_tls_handshake_details(self):
        """
        This function returns crytographic and certificate verification details in the tls handshake.
        """
        return {'client_hello_signature_options': ['ecdsa_secp256r1_sha256', 'ecdsa_secp384r1_sha384', 'ecdsa_secp521r1_sha512', 'ed25519', 'ed448', 'rsa_pss_pss_sha256', 'rsa_pss_pss_sha384', 'rsa_pss_pss_sha512', 'rsa_pss_rsae_sha256', 'rsa_pss_rsae_sha384', 'rsa_pss_rsae_sha512', 'rsa_pkcs1_sha256', 'rsa_pkcs1_sha384', 'rsa_pkcs1_sha512', 'UNKNOWN-14', 'ecdsa_sha1', 'UNKNOWN-16', 'rsa_pkcs1_sha1', 'UNKNOWN-18', 'UNKNOWN-19', 'UNKNOWN-20', 'UNKNOWN-21', 'UNKNOWN-22'], 'client_hello_encryption_options': ['TLS_AES_256_GCM_SHA384', 'TLS_CHACHA20_POLY1305_SHA256', 'TLS_AES_128_GCM_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384', 'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384', 'TLS_DHE_DSS_WITH_AES_256_GCM_SHA384', 'TLS_DHE_RSA_WITH_AES_256_GCM_SHA384', 'TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256', 'TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256', 'TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_256_CCM_8', 'TLS_ECDHE_ECDSA_WITH_AES_256_CCM', 'TLS_DHE_RSA_WITH_AES_256_CCM_8', 'TLS_DHE_RSA_WITH_AES_256_CCM', 'TLS_ECDHE_ECDSA_WITH_ARIA_256_GCM_SHA384', 'TLS_ECDHE_RSA_WITH_ARIA_256_GCM_SHA384', 'TLS_DHE_DSS_WITH_ARIA_256_GCM_SHA384', 'TLS_DHE_RSA_WITH_ARIA_256_GCM_SHA384', 'TLS_DH_anon_WITH_AES_256_GCM_SHA384', 'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256', 'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256', 'TLS_DHE_DSS_WITH_AES_128_GCM_SHA256', 'TLS_DHE_RSA_WITH_AES_128_GCM_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8', 'TLS_ECDHE_ECDSA_WITH_AES_128_CCM', 'TLS_DHE_RSA_WITH_AES_128_CCM_8', 'TLS_DHE_RSA_WITH_AES_128_CCM', 'TLS_ECDHE_ECDSA_WITH_ARIA_128_GCM_SHA256', 'TLS_ECDHE_RSA_WITH_ARIA_128_GCM_SHA256', 'TLS_DHE_DSS_WITH_ARIA_128_GCM_SHA256', 'TLS_DHE_RSA_WITH_ARIA_128_GCM_SHA256', 'TLS_DH_anon_WITH_AES_128_GCM_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384', 'TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384', 'TLS_DHE_RSA_WITH_AES_256_CBC_SHA256', 'TLS_DHE_DSS_WITH_AES_256_CBC_SHA256', 'TLS_ECDHE_ECDSA_WITH_CAMELLIA_256_CBC_SHA384', 'TLS_ECDHE_RSA_WITH_CAMELLIA_256_CBC_SHA384', 'TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA256', 'TLS_DHE_DSS_WITH_CAMELLIA_256_CBC_SHA256', 'TLS_DH_anon_WITH_AES_256_CBC_SHA256', 'TLS_DH_anon_WITH_CAMELLIA_256_CBC_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256', 'TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256', 'TLS_DHE_RSA_WITH_AES_128_CBC_SHA256', 'TLS_DHE_DSS_WITH_AES_128_CBC_SHA256', 'TLS_ECDHE_ECDSA_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_ECDHE_RSA_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_DHE_DSS_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_DH_anon_WITH_AES_128_CBC_SHA256', 'TLS_DH_anon_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA', 'TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA', 'TLS_DHE_RSA_WITH_AES_256_CBC_SHA', 'TLS_DHE_DSS_WITH_AES_256_CBC_SHA', 'TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA', 'TLS_DHE_DSS_WITH_CAMELLIA_256_CBC_SHA', 'TLS_ECDH_anon_WITH_AES_256_CBC_SHA', 'TLS_DH_anon_WITH_AES_256_CBC_SHA', 'TLS_DH_anon_WITH_CAMELLIA_256_CBC_SHA', 'TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA', 'TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA', 'TLS_DHE_RSA_WITH_AES_128_CBC_SHA', 'TLS_DHE_DSS_WITH_AES_128_CBC_SHA', 'TLS_DHE_RSA_WITH_SEED_CBC_SHA', 'TLS_DHE_DSS_WITH_SEED_CBC_SHA', 'TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA', 'TLS_DHE_DSS_WITH_CAMELLIA_128_CBC_SHA', 'TLS_ECDH_anon_WITH_AES_128_CBC_SHA', 'TLS_DH_anon_WITH_AES_128_CBC_SHA', 'TLS_DH_anon_WITH_SEED_CBC_SHA', 'TLS_DH_anon_WITH_CAMELLIA_128_CBC_SHA', 'TLS_RSA_WITH_AES_256_GCM_SHA384', 'TLS_RSA_WITH_AES_256_CCM_8', 'TLS_RSA_WITH_AES_256_CCM', 'TLS_RSA_WITH_ARIA_256_GCM_SHA384', 'TLS_RSA_WITH_AES_128_GCM_SHA256', 'TLS_RSA_WITH_AES_128_CCM_8', 'TLS_RSA_WITH_AES_128_CCM', 'TLS_RSA_WITH_ARIA_128_GCM_SHA256', 'TLS_RSA_WITH_AES_256_CBC_SHA256', 'TLS_RSA_WITH_CAMELLIA_256_CBC_SHA256', 'TLS_RSA_WITH_AES_128_CBC_SHA256', 'TLS_RSA_WITH_CAMELLIA_128_CBC_SHA256', 'TLS_RSA_WITH_AES_256_CBC_SHA', 'TLS_RSA_WITH_CAMELLIA_256_CBC_SHA', 'TLS_RSA_WITH_AES_128_CBC_SHA', 'TLS_RSA_WITH_SEED_CBC_SHA', 'TLS_RSA_WITH_CAMELLIA_128_CBC_SHA', 'TLS_EMPTY_RENEGOTIATION_INFO_SCSV'], 'server_hello_encryption_selection': 'TLS_AES_256_GCM_SHA384', 'certificateLength': '1844', 'certificateProvider': "Let's Encrypt", 'certificatePublicKeyAlgorithm': 'id-ecPublicKey', 'subjectPublicKey': '0455ddabdfae4f2381f7ac5cd4d21528c61ddc9ae3fb0f6fde1aa11e5ae7532f1f93be4câ€¦', 'signature algorithm selection': 'ecdsa_secp256r1_sha256'}

    def get_http_details(self):
        return {'httpRequestHeader': 'HEADER: GET /', 'httpResponseHeader': 'HEADER: 301 Moved Permanently', 'num_of_http_data_packets': 0, 'average_http_packet_size': 0}

    def get_ip_details(self):
        return {'ClientIP': '192.168.10.128', 'ServerIP': '208.80.153.224', 'IP_version': 4}

if __name__ == "__main__":
    # Testing
    backend = AliceBackend()
    backend.browse_and_capture()  # default browsing google
    print(backend.get_encrypted_packets())
    print(backend.get_decrypted_packets())
    print(backend.get_tls_handshake_details())